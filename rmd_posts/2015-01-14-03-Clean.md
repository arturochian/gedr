---
title: "03 - Clean"
author: Jeffrey W. Hollister
layout: post_page
---

In my experience, most data analysis and statistics classes seem to assume that 95% of the time spent working with data is on the analysis and interpretation of that analysis and little time is spent getting data ready to analyze and, therefore, very little time is devoted to learning how to do this. However, in reality, I'd argue, the time spent is flipped with most time spent on cleaning up data and significantly less time on the analysis.    

Cleaning data (or data munging, data jujitsu, data wrangling) often happens at two points.  The first stage is getting raw data files ready to be read in by the computer.  This can be quite the challenge.  For the purposes of this workshop we are not going to focus on that side too much.  The data files we are using are in a clean enough format to be read in directly.  If you want to learn more about some best practices in maintaining good clean data files, I'd point you to two places.  First is some materials from [Data Carpentry on working with spreadsheets](https://github.com/datacarpentry/datacarpentry/blob/master/lessons/excel/ecology_spreadsheets.md) and second is [Hadley Wickham's Tidy Data paper](http://www.jstatsoft.org/v59/i10/paper).

From here on out we are assuming that we have a raw data file that is ready to be read into R and that we have already done that (we did this in [Lesson 2:Exercise 2](/gedr/2015/01/14/02-Get/#exercise-2)).  While the data files are in pretty good shape at this point, there are often tasks that we need to do to select out portions of the data, rearranage the data, add new columns, merge multiple files, etc.  These are the tasks that we will focus on over the next two lessons.  This lesson will deal with using tools we have available to us in Base R.  Next lesson will focus on a new package `dplyr` that should make some of this work a bit easier.  

##Subset
But first, lets start exploring indexing to subset both observations (the rows) and variables (the columns).

Some of the commands we know already, like `head()` and `tail()` kind of do this, but we need more control than that.  We get that with indexing.  In short indexing allows you to specify individual (or ranges) of rows and columns.  We can index data frames and vectors (and lists and matrices, but we aren't going to go into that).  Let's start with a vector example and build from there.


{% highlight r %}
#Create a vector
x<-c(10:19)
x
{% endhighlight %}



{% highlight text %}
##  [1] 10 11 12 13 14 15 16 17 18 19
{% endhighlight %}



{% highlight r %}
#Postive indexing returns just the value in the ith place
x[7]
{% endhighlight %}



{% highlight text %}
## [1] 16
{% endhighlight %}



{% highlight r %}
#Negative indexing returns all values except the value in the ith place
x[-3]
{% endhighlight %}



{% highlight text %}
## [1] 10 11 13 14 15 16 17 18 19
{% endhighlight %}



{% highlight r %}
#Ranges work too
x[8:10]
{% endhighlight %}



{% highlight text %}
## [1] 17 18 19
{% endhighlight %}



{% highlight r %}
#A vector can be used to index
#Can be numeric
x[c(2,6,10)]
{% endhighlight %}



{% highlight text %}
## [1] 11 15 19
{% endhighlight %}



{% highlight r %}
#Can be boolean - will repeat the pattern 
x[c(TRUE,FALSE)]
{% endhighlight %}



{% highlight text %}
## [1] 10 12 14 16 18
{% endhighlight %}



{% highlight r %}
#Can even get fancy
x[x%%2==0]
{% endhighlight %}



{% highlight text %}
## [1] 10 12 14 16 18
{% endhighlight %}
 
So that's kinda handy.  In practice you wouldn't likely just be asking for that information to be returned to the screen, you'd probably save the output to a new object, kind of like `evens<-x[x%%2==0]`.  Let's move on now and look at indexing data frames.

Since a data frame has two dimensions, you need to specify an index for both the row and the column.  You can specify both and get a single value like `data_frame[row,column`],specify just the row and the get the whole row back like `data_frame[row,]` or get just the column with `data_frame[,column]`.  Let's work some examples.


{% highlight r %}
#Let's use one of the stock data frames in R, iris
head(iris)
{% endhighlight %}



{% highlight text %}
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
{% endhighlight %}



{% highlight r %}
#And grab a specific value
iris[1,1]
{% endhighlight %}



{% highlight text %}
## [1] 5.1
{% endhighlight %}



{% highlight r %}
#A whole column
petal_len<-iris[,3]
petal_len
{% endhighlight %}



{% highlight text %}
##   [1] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 1.5 1.6 1.4 1.1 1.2 1.5 1.3
##  [18] 1.4 1.7 1.5 1.7 1.5 1.0 1.7 1.9 1.6 1.6 1.5 1.4 1.6 1.6 1.5 1.5 1.4
##  [35] 1.5 1.2 1.3 1.4 1.3 1.5 1.3 1.3 1.3 1.6 1.9 1.4 1.6 1.4 1.5 1.4 4.7
##  [52] 4.5 4.9 4.0 4.6 4.5 4.7 3.3 4.6 3.9 3.5 4.2 4.0 4.7 3.6 4.4 4.5 4.1
##  [69] 4.5 3.9 4.8 4.0 4.9 4.7 4.3 4.4 4.8 5.0 4.5 3.5 3.8 3.7 3.9 5.1 4.5
##  [86] 4.5 4.7 4.4 4.1 4.0 4.4 4.6 4.0 3.3 4.2 4.2 4.2 4.3 3.0 4.1 6.0 5.1
## [103] 5.9 5.6 5.8 6.6 4.5 6.3 5.8 6.1 5.1 5.3 5.5 5.0 5.1 5.3 5.5 6.7 6.9
## [120] 5.0 5.7 4.9 6.7 4.9 5.7 6.0 4.8 4.9 5.6 5.8 6.1 6.4 5.6 5.1 5.6 6.1
## [137] 5.6 5.5 4.8 5.4 5.6 5.1 5.1 5.9 5.7 5.2 5.0 5.2 5.4 5.1
{% endhighlight %}



{% highlight r %}
#A row
obs15<-iris[15,]
obs15
{% endhighlight %}



{% highlight text %}
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 15          5.8           4          1.2         0.2  setosa
{% endhighlight %}



{% highlight r %}
#Many rows
obs3to7<-iris[3:7,]
obs3to7
{% endhighlight %}



{% highlight text %}
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
## 7          4.6         3.4          1.4         0.3  setosa
{% endhighlight %}

So that's the basics.  Still in the arena of kinda useful, but not really... Remember though that we can index vectors with other vectors and a data frame is just a collection of vectors (kinda) and that starts to get interesting.  Also remember that data frames have column names.  We can use those too.  Let's try it.


{% highlight r %}
#First, there are a couple of ways to use the column names
iris$Petal.Length
{% endhighlight %}



{% highlight text %}
##   [1] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 1.5 1.6 1.4 1.1 1.2 1.5 1.3
##  [18] 1.4 1.7 1.5 1.7 1.5 1.0 1.7 1.9 1.6 1.6 1.5 1.4 1.6 1.6 1.5 1.5 1.4
##  [35] 1.5 1.2 1.3 1.4 1.3 1.5 1.3 1.3 1.3 1.6 1.9 1.4 1.6 1.4 1.5 1.4 4.7
##  [52] 4.5 4.9 4.0 4.6 4.5 4.7 3.3 4.6 3.9 3.5 4.2 4.0 4.7 3.6 4.4 4.5 4.1
##  [69] 4.5 3.9 4.8 4.0 4.9 4.7 4.3 4.4 4.8 5.0 4.5 3.5 3.8 3.7 3.9 5.1 4.5
##  [86] 4.5 4.7 4.4 4.1 4.0 4.4 4.6 4.0 3.3 4.2 4.2 4.2 4.3 3.0 4.1 6.0 5.1
## [103] 5.9 5.6 5.8 6.6 4.5 6.3 5.8 6.1 5.1 5.3 5.5 5.0 5.1 5.3 5.5 6.7 6.9
## [120] 5.0 5.7 4.9 6.7 4.9 5.7 6.0 4.8 4.9 5.6 5.8 6.1 6.4 5.6 5.1 5.6 6.1
## [137] 5.6 5.5 4.8 5.4 5.6 5.1 5.1 5.9 5.7 5.2 5.0 5.2 5.4 5.1
{% endhighlight %}



{% highlight r %}
iris["Petal.Length"]
{% endhighlight %}



{% highlight text %}
##     Petal.Length
## 1            1.4
## 2            1.4
## 3            1.3
## 4            1.5
## 5            1.4
## 6            1.7
## 7            1.4
## 8            1.5
## 9            1.4
## 10           1.5
## 11           1.5
## 12           1.6
## 13           1.4
## 14           1.1
## 15           1.2
## 16           1.5
## 17           1.3
## 18           1.4
## 19           1.7
## 20           1.5
## 21           1.7
## 22           1.5
## 23           1.0
## 24           1.7
## 25           1.9
## 26           1.6
## 27           1.6
## 28           1.5
## 29           1.4
## 30           1.6
## 31           1.6
## 32           1.5
## 33           1.5
## 34           1.4
## 35           1.5
## 36           1.2
## 37           1.3
## 38           1.4
## 39           1.3
## 40           1.5
## 41           1.3
## 42           1.3
## 43           1.3
## 44           1.6
## 45           1.9
## 46           1.4
## 47           1.6
## 48           1.4
## 49           1.5
## 50           1.4
## 51           4.7
## 52           4.5
## 53           4.9
## 54           4.0
## 55           4.6
## 56           4.5
## 57           4.7
## 58           3.3
## 59           4.6
## 60           3.9
## 61           3.5
## 62           4.2
## 63           4.0
## 64           4.7
## 65           3.6
## 66           4.4
## 67           4.5
## 68           4.1
## 69           4.5
## 70           3.9
## 71           4.8
## 72           4.0
## 73           4.9
## 74           4.7
## 75           4.3
## 76           4.4
## 77           4.8
## 78           5.0
## 79           4.5
## 80           3.5
## 81           3.8
## 82           3.7
## 83           3.9
## 84           5.1
## 85           4.5
## 86           4.5
## 87           4.7
## 88           4.4
## 89           4.1
## 90           4.0
## 91           4.4
## 92           4.6
## 93           4.0
## 94           3.3
## 95           4.2
## 96           4.2
## 97           4.2
## 98           4.3
## 99           3.0
## 100          4.1
## 101          6.0
## 102          5.1
## 103          5.9
## 104          5.6
## 105          5.8
## 106          6.6
## 107          4.5
## 108          6.3
## 109          5.8
## 110          6.1
## 111          5.1
## 112          5.3
## 113          5.5
## 114          5.0
## 115          5.1
## 116          5.3
## 117          5.5
## 118          6.7
## 119          6.9
## 120          5.0
## 121          5.7
## 122          4.9
## 123          6.7
## 124          4.9
## 125          5.7
## 126          6.0
## 127          4.8
## 128          4.9
## 129          5.6
## 130          5.8
## 131          6.1
## 132          6.4
## 133          5.6
## 134          5.1
## 135          5.6
## 136          6.1
## 137          5.6
## 138          5.5
## 139          4.8
## 140          5.4
## 141          5.6
## 142          5.1
## 143          5.1
## 144          5.9
## 145          5.7
## 146          5.2
## 147          5.0
## 148          5.2
## 149          5.4
## 150          5.1
{% endhighlight %}



{% highlight r %}
#Multiple colums
iris[c("Petal.Length","Species")]
{% endhighlight %}



{% highlight text %}
##     Petal.Length    Species
## 1            1.4     setosa
## 2            1.4     setosa
## 3            1.3     setosa
## 4            1.5     setosa
## 5            1.4     setosa
## 6            1.7     setosa
## 7            1.4     setosa
## 8            1.5     setosa
## 9            1.4     setosa
## 10           1.5     setosa
## 11           1.5     setosa
## 12           1.6     setosa
## 13           1.4     setosa
## 14           1.1     setosa
## 15           1.2     setosa
## 16           1.5     setosa
## 17           1.3     setosa
## 18           1.4     setosa
## 19           1.7     setosa
## 20           1.5     setosa
## 21           1.7     setosa
## 22           1.5     setosa
## 23           1.0     setosa
## 24           1.7     setosa
## 25           1.9     setosa
## 26           1.6     setosa
## 27           1.6     setosa
## 28           1.5     setosa
## 29           1.4     setosa
## 30           1.6     setosa
## 31           1.6     setosa
## 32           1.5     setosa
## 33           1.5     setosa
## 34           1.4     setosa
## 35           1.5     setosa
## 36           1.2     setosa
## 37           1.3     setosa
## 38           1.4     setosa
## 39           1.3     setosa
## 40           1.5     setosa
## 41           1.3     setosa
## 42           1.3     setosa
## 43           1.3     setosa
## 44           1.6     setosa
## 45           1.9     setosa
## 46           1.4     setosa
## 47           1.6     setosa
## 48           1.4     setosa
## 49           1.5     setosa
## 50           1.4     setosa
## 51           4.7 versicolor
## 52           4.5 versicolor
## 53           4.9 versicolor
## 54           4.0 versicolor
## 55           4.6 versicolor
## 56           4.5 versicolor
## 57           4.7 versicolor
## 58           3.3 versicolor
## 59           4.6 versicolor
## 60           3.9 versicolor
## 61           3.5 versicolor
## 62           4.2 versicolor
## 63           4.0 versicolor
## 64           4.7 versicolor
## 65           3.6 versicolor
## 66           4.4 versicolor
## 67           4.5 versicolor
## 68           4.1 versicolor
## 69           4.5 versicolor
## 70           3.9 versicolor
## 71           4.8 versicolor
## 72           4.0 versicolor
## 73           4.9 versicolor
## 74           4.7 versicolor
## 75           4.3 versicolor
## 76           4.4 versicolor
## 77           4.8 versicolor
## 78           5.0 versicolor
## 79           4.5 versicolor
## 80           3.5 versicolor
## 81           3.8 versicolor
## 82           3.7 versicolor
## 83           3.9 versicolor
## 84           5.1 versicolor
## 85           4.5 versicolor
## 86           4.5 versicolor
## 87           4.7 versicolor
## 88           4.4 versicolor
## 89           4.1 versicolor
## 90           4.0 versicolor
## 91           4.4 versicolor
## 92           4.6 versicolor
## 93           4.0 versicolor
## 94           3.3 versicolor
## 95           4.2 versicolor
## 96           4.2 versicolor
## 97           4.2 versicolor
## 98           4.3 versicolor
## 99           3.0 versicolor
## 100          4.1 versicolor
## 101          6.0  virginica
## 102          5.1  virginica
## 103          5.9  virginica
## 104          5.6  virginica
## 105          5.8  virginica
## 106          6.6  virginica
## 107          4.5  virginica
## 108          6.3  virginica
## 109          5.8  virginica
## 110          6.1  virginica
## 111          5.1  virginica
## 112          5.3  virginica
## 113          5.5  virginica
## 114          5.0  virginica
## 115          5.1  virginica
## 116          5.3  virginica
## 117          5.5  virginica
## 118          6.7  virginica
## 119          6.9  virginica
## 120          5.0  virginica
## 121          5.7  virginica
## 122          4.9  virginica
## 123          6.7  virginica
## 124          4.9  virginica
## 125          5.7  virginica
## 126          6.0  virginica
## 127          4.8  virginica
## 128          4.9  virginica
## 129          5.6  virginica
## 130          5.8  virginica
## 131          6.1  virginica
## 132          6.4  virginica
## 133          5.6  virginica
## 134          5.1  virginica
## 135          5.6  virginica
## 136          6.1  virginica
## 137          5.6  virginica
## 138          5.5  virginica
## 139          4.8  virginica
## 140          5.4  virginica
## 141          5.6  virginica
## 142          5.1  virginica
## 143          5.1  virginica
## 144          5.9  virginica
## 145          5.7  virginica
## 146          5.2  virginica
## 147          5.0  virginica
## 148          5.2  virginica
## 149          5.4  virginica
## 150          5.1  virginica
{% endhighlight %}



{% highlight r %}
#Now we can combine what we have seen to do some more complex queries
#Lets get all the data for Species with a petal length greater than 6
big_iris<-iris[iris$Petal.Length>=6,]
big_iris
{% endhighlight %}



{% highlight text %}
##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
## 101          6.3         3.3          6.0         2.5 virginica
## 106          7.6         3.0          6.6         2.1 virginica
## 108          7.3         2.9          6.3         1.8 virginica
## 110          7.2         3.6          6.1         2.5 virginica
## 118          7.7         3.8          6.7         2.2 virginica
## 119          7.7         2.6          6.9         2.3 virginica
## 123          7.7         2.8          6.7         2.0 virginica
## 126          7.2         3.2          6.0         1.8 virginica
## 131          7.4         2.8          6.1         1.9 virginica
## 132          7.9         3.8          6.4         2.0 virginica
## 136          7.7         3.0          6.1         2.3 virginica
{% endhighlight %}



{% highlight r %}
#Or maybe we want just the sepal widths of the virginica species
virginica_iris<-iris$Sepal.Width[iris$Species=="virginica"]
virginica_iris
{% endhighlight %}



{% highlight text %}
##  [1] 3.3 2.7 3.0 2.9 3.0 3.0 2.5 2.9 2.5 3.6 3.2 2.7 3.0 2.5 2.8 3.2 3.0
## [18] 3.8 2.6 2.2 3.2 2.8 2.8 2.7 3.3 3.2 2.8 3.0 2.8 3.0 2.8 3.8 2.8 2.8
## [35] 2.6 3.0 3.4 3.1 3.0 3.1 3.1 3.1 2.7 3.2 3.3 3.0 2.5 3.0 3.4 3.0
{% endhighlight %}

Got it?!  Probably sort of!?  I will admit that the syntax for subsetting data this way is a bit obtuse.  I did want to make sure you all saw it though becuase it comes up often in other peoples code and helps you get a better understanding, I think, of what you are doing.  That being said there are other options.  In base, `subset()` and also in `dplyr` which will be the next lesson.


{% highlight r %}
#And redo what we did above
big_iris_subset<-subset(iris,subset=Petal.Length>=6)
big_iris_subset
{% endhighlight %}



{% highlight text %}
##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
## 101          6.3         3.3          6.0         2.5 virginica
## 106          7.6         3.0          6.6         2.1 virginica
## 108          7.3         2.9          6.3         1.8 virginica
## 110          7.2         3.6          6.1         2.5 virginica
## 118          7.7         3.8          6.7         2.2 virginica
## 119          7.7         2.6          6.9         2.3 virginica
## 123          7.7         2.8          6.7         2.0 virginica
## 126          7.2         3.2          6.0         1.8 virginica
## 131          7.4         2.8          6.1         1.9 virginica
## 132          7.9         3.8          6.4         2.0 virginica
## 136          7.7         3.0          6.1         2.3 virginica
{% endhighlight %}



{% highlight r %}
virginica_iris_subset<-subset(iris,subset=Species=="virginica",select=Sepal.Width)
virginica_iris_subset
{% endhighlight %}



{% highlight text %}
##     Sepal.Width
## 101         3.3
## 102         2.7
## 103         3.0
## 104         2.9
## 105         3.0
## 106         3.0
## 107         2.5
## 108         2.9
## 109         2.5
## 110         3.6
## 111         3.2
## 112         2.7
## 113         3.0
## 114         2.5
## 115         2.8
## 116         3.2
## 117         3.0
## 118         3.8
## 119         2.6
## 120         2.2
## 121         3.2
## 122         2.8
## 123         2.8
## 124         2.7
## 125         3.3
## 126         3.2
## 127         2.8
## 128         3.0
## 129         2.8
## 130         3.0
## 131         2.8
## 132         3.8
## 133         2.8
## 134         2.8
## 135         2.6
## 136         3.0
## 137         3.4
## 138         3.1
## 139         3.0
## 140         3.1
## 141         3.1
## 142         3.1
## 143         2.7
## 144         3.2
## 145         3.3
## 146         3.0
## 147         2.5
## 148         3.0
## 149         3.4
## 150         3.0
{% endhighlight %}

So, I think that is a big improvement in the syntax over the raw indexing and certainly lends itself to more understandable code.

##Exercise 1
This exercise is going to focus on using what we just covered on indexing and subsetting to start to clean up the National Lakes Assessment data files.  Remember to use the stickies: green when your done, red if you have a problem.

1. If it isn't already open, make sure you have the script we created, "nla_analysis.R" opened up.
2. Start a new section of code in this script by simply putting in a line or two of comments indicating what it is this set of code does.
3. Our goal for this is to create two new data frames that represent a subset of the observations as well as a subset of the data. 
4. First, from the  `nla_sites` data frame we want a new data frame that has only the following columns: SITE_ID, LON_DD, LAT_DD, STATE_NAME, WSA_ECO9, NUT_REG, NUTREG_NAME, LAKE_ORIGIN, and RT_NLA.  Name the new data frame `nla_sites_subset`.
5. Next, lets subset the water quality data from `nla_wq`.  The columns we want for this are: SITE_ID, VISIT_NO, SITE_TYPE, TURB, NTL, PTL, CHLA, and SECMEAN. Call this `nla_wq_subset`.
6. Last thing we are going to need to do is get a subset of the observations from `nla_wq_subset`.  We need only the lakes that with VISIT_NO equal to 1 and SITE_TYPE equal to "REF_Lake".  Keep the same name, `nla_wq_subset`, for this data frame.

##Merging Data

##Exercise 2

##Reshape and Modifying

##Exercise 3
